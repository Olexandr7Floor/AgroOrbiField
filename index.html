<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AgroVerse ‚Äî Farm with NASA Data (MVP)</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <style>
    :root{--accent:#2b8cbe;--bg:#0f1720;--card:#0b1220;--muted:#9aa8b2}
    html,body,#app{height:100%;margin:0;font-family:Inter,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#071025 0%, #0b1320 100%);color:#e6eef6}
    .container{display:grid;grid-template-columns:420px 1fr;gap:18px;padding:18px;height:100%}
    .card{background:rgba(255,255,255,0.03);border-radius:12px;padding:14px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    #map{height:100%;border-radius:8px}
    h1{margin:0 0 6px 0;font-size:18px}
    .muted{color:var(--muted);font-size:13px}
    .sidebar{display:flex;flex-direction:column;gap:12px;height:100%}
    .small{font-size:13px}
    label{display:block;font-size:13px;margin-bottom:6px}
    input[type=range]{width:100%}
    button{background:var(--accent);border:none;padding:8px 12px;border-radius:8px;color:white;cursor:pointer}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06)}
    .row{display:flex;gap:8px;align-items:center}
    .log{height:120px;overflow:auto;background:rgba(0,0,0,0.15);padding:8px;border-radius:8px;font-size:13px}
    .lessons{max-height:160px;overflow:auto}
    .scenario{padding:8px;border-radius:8px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));cursor:pointer}
    .score{font-weight:700;color:#b6f7c6}
    footer{position:absolute;left:18px;right:18px;bottom:18px;color:var(--muted);font-size:13px}
    #errors {position:fixed;right:10px;top:10px;max-width:320px;z-index:1000;color:#f66;font-size:13px;}
    @media(max-width:900px){.container{grid-template-columns:1fr;padding:10px}.sidebar{order:2}.card{padding:10px}}
  </style>
</head>
<body>
  <div id="app">
    <div class="container">
      <div class="card sidebar">
        <div>
          <h1>AgroVerse ‚Äî Farm with NASA Data</h1>
          <div class="muted">–û–±–µ—Ä—ñ—Ç—å –∫—Ä–∞—ó–Ω—É –Ω–∞ –∫–∞—Ä—Ç—ñ ‚Üí –æ—Ç—Ä–∏–º–∞–π—Ç–µ –¥–∞–Ω—ñ NASA ‚Üí –ø–ª–∞–Ω—É–π—Ç–µ —Å–µ–∑–æ–Ω</div>
        </div>

        <div>
          <label class="small">–û–±—Ä–∞–Ω–∞ –∫—Ä–∞—ó–Ω–∞</label>
          <div id="coords" class="muted">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ –∫–∞—Ä—Ç—É</div>
        </div>

        <div>
          <label class="small">–û–±—Ä–∞—Ç–∏ –∫—É–ª—å—Ç—É—Ä—É</label>
          <select id="cropSelect">
            <option value="maize">–ö—É–∫—É—Ä—É–¥–∑–∞</option>
            <option value="wheat">–ü—à–µ–Ω–∏—Ü—è</option>
            <option value="soy">–°–æ—è</option>
            <option value="sorghum">–°–æ—Ä–≥–æ (–ø–æ—Å—É—Ö–æ—Å—Ç—ñ–π–∫–µ)</option>
          </select>
        </div>

        <div>
          <label class="small">–ü–æ–ª–∏–≤ (–ª—ñ—Ç—Ä—ñ–≤ / –º¬≤ / —Ç–∏–∂–¥–µ–Ω—å)</label>
          <input id="irrigation" type="range" min="0" max="10" step="0.5" value="3" oninput="irrigationOut.textContent = irrigation.value">
          <div class="row"><div class="muted">–Ü–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ñ—Å—Ç—å –ø–æ–ª–∏–≤—É</div><div style="margin-left:auto" id="irrigationOut">3</div></div>
        </div>

        <div>
          <label class="small">–î–æ–±—Ä–∏–≤–∞ (N) ‚Äî –æ–¥–∏–Ω–∏—Ü—å / –≥–∞</label>
          <input id="fert" type="range" min="0" max="200" step="10" value="80" oninput="fertOut.textContent = fert.value">
          <div class="row"><div class="muted">–ë–∞–ª–∞–Ω—Å—É–π—Ç–µ –≤—Ä–æ–∂–∞–π —ñ –¥–æ–≤–∫—ñ–ª–ª—è</div><div style="margin-left:auto" id="fertOut">80</div></div>
        </div>

        <div class="row">
          <button id="runSim">–ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ–∑–æ–Ω</button>
          <button class="btn-ghost" id="reset">–°–∫–∏–Ω—É—Ç–∏</button>
        </div>

        <div>
          <label class="small">–°—Ü–µ–Ω–∞—Ä—ñ—ó</label>
          <div class="lessons" id="scenarios"></div>
        </div>

        <div>
          <label class="small">–ö–æ—Ä–æ—Ç–∫—ñ —É—Ä–æ–∫–∏</label>
          <div class="lessons" id="lessons"></div>
        </div>

        <div>
          <label class="small">–õ–æ–≥–∏ / –ó–≤—ñ—Ç</label>
          <div class="log" id="log">–ì–æ—Ç–æ–≤–æ. –í–∏–±–µ—Ä—ñ—Ç—å –∫—Ä–∞—ó–Ω—É.</div>
        </div>
      </div>

      <div class="card" style="display:flex;flex-direction:column;gap:10px;">
        <div style="height:60%;min-height:320px;position:relative;">
          <div id="errors"></div>
          <div id="map" style="height:100%"></div>
        </div>

        <div style="display:grid;grid-template-columns:1fr 340px;gap:12px;align-items:start;">
          <div class="card" style="padding:10px;">
            <h3>–ê–Ω–∞–ª—ñ–∑ –¥–∞–Ω–∏—Ö (NASA POWER)</h3>
            <div id="dataSummary" class="muted small">–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö</div>
            <div id="plot" style="height:120px;margin-top:8px;background:rgba(0,0,0,0.12);border-radius:8px;display:flex;align-items:center;justify-content:center;color:var(--muted)">–ì—Ä–∞—Ñ—ñ–∫ (MVP)</div>
          </div>

          <div class="card" style="padding:10px;">
            <h3>–ü—ñ–¥—Å—É–º–æ–∫ —Å–µ–∑–æ–Ω—É</h3>
            <div class="muted small">–û—Ü—ñ–Ω–∫–∞ –µ–∫–æ–ª–æ–≥—ñ—á–Ω–æ—Å—Ç—ñ —Ç–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ</div>
            <div style="margin-top:8px">
              <div>–í—Ä–æ–∂–∞–π: <span id="yieldVal">‚Äî</span></div>
              <div>–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤–æ–¥–∏: <span id="waterVal">‚Äî</span></div>
              <div>–í–∏–∫–∏–¥–∏ / –µ–∫–æ–ª–æ–≥—ñ—è: <span id="ecoVal">‚Äî</span></div>
              <div style="margin-top:8px">–û—Ü—ñ–Ω–∫–∞ (score): <span class="score" id="scoreVal">‚Äî</span></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <footer>–ü—Ä–æ—Ç–æ—Ç–∏–ø ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ NASA POWER API. –£ –ø–æ–≤–Ω—ñ–π –≤–µ—Ä—Å—ñ—ó –±—É–¥—É—Ç—å —ñ–Ω—à—ñ —Å–µ—Ä–≤—ñ—Å–∏.</footer>
  </div>

  <!-- Leaflet -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- Turf.js –¥–ª—è –≥–µ–æ–æ–ø–µ—Ä–∞—Ü—ñ–π -->
  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>

  <script>
    const errorsEl = document.getElementById('errors');
    function showError(msg){console.error(msg);errorsEl.textContent = msg;}

    let map = L.map('map',{
      minZoom:2,maxZoom:8,worldCopyJump:false,
      maxBounds:[[-85,-180],[85,180]],maxBoundsViscosity:1.0
    }).setView([20,0],2);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
      maxZoom:19,attribution:'¬© OpenStreetMap contributors'
    }).addTo(map);

    const info = document.getElementById('coords');
    const logEl = document.getElementById('log');
    function log(text){
      const p = document.createElement('div');
      p.textContent = '[' + new Date().toLocaleTimeString() + '] ' + text;
      logEl.prepend(p);
    }

    let geoData = null;

    fetch("https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson")
      .then(r => r.json())
      .then(data => {
        geoData = data;
        L.geoJSON(data,{style:{color:"#3388ff",weight:1,fillOpacity:0.05}}).addTo(map);
      });

      map.on("click", e => {
  if(!geoData) return;

  const clickedFeature = geoData.features.find(f => 
    turf.booleanPointInPolygon([e.latlng.lng, e.latlng.lat], f)
  );

  if(clickedFeature){
    const name = clickedFeature.properties?.ADMIN || clickedFeature.properties?.name || "–ù–µ–≤—ñ–¥–æ–º–æ";
    info.textContent = "üåç " + name;
    log("–û–±—Ä–∞–Ω–∞ –∫—Ä–∞—ó–Ω–∞: " + name);
  } else {
    info.textContent = "–û–∫–µ–∞–Ω –∞–±–æ –Ω–µ–≤–∏–∑–Ω–∞—á–µ–Ω–∞ –∑–æ–Ω–∞";
  }
});

  </script>
</body>
</html>
