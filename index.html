<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AgroVerse ‚Äî –°–∏–º—É–ª—è—Ç–æ—Ä –§–µ—Ä–º–∏ NASA POWER</title>
  
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  
  <!-- Leaflet Draw CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />
  
  <!-- Google Fonts (Inter) -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* CSS Styles (Dark Theme from main.css) */
    :root {
        --primary: #2b8cbe; /* Blue */
        --primary-dark: #1a6a9c;
        --secondary: #cbe22b; /* Lime Green */
        --secondary-light: #b6f7c6;
        --bg-dark: #0f1720;
        --bg-card: rgba(13, 25, 43, 0.9); /* Semi-transparent dark card */
        --bg-card-light: rgba(255, 255, 255, 0.05);
        --text-primary: #e6eef6;
        --text-secondary: #9aa8b2;
        --text-muted: #6b7a85;
        --border: rgba(255, 255, 255, 0.08);
        --success: #4CAF50;
        --warning: #FF9800;
        --danger: #f44336;
        --shadow: 0 8px 32px rgba(2, 6, 23, 0.4);
        --radius: 12px;
        --transition: all 0.3s ease;
    }
    
    * {
      box-sizing: border-box;
    }
    
    html, body, #app {
        height: 100%;
        margin: 0;
        font-family: 'Inter', 'Segoe UI', Roboto, Arial, sans-serif;
        /* Dark blue gradient background */
        background: linear-gradient(135deg, #071025 0%, #0f1720 100%);
        color: var(--text-primary);
        overflow: hidden;
    }

    #app {
        display: flex;
        flex-direction: column;
    }

    .container {
        display: grid;
        grid-template-columns: 380px 1fr;
        gap: 24px;
        padding: 24px;
        width: 100%;
        max-width: 1400px;
        margin: 0 auto;
        flex-grow: 1;
        overflow: hidden;
    }
    
    .card {
        background: var(--bg-card);
        backdrop-filter: blur(8px);
        border-radius: var(--radius);
        padding: 20px;
        box-shadow: var(--shadow);
        border: 1px solid var(--border);
    }

    #map {
        height: 100%;
        min-height: 400px;
        border-radius: var(--radius);
        border: 1px solid var(--border);
        box-shadow: var(--shadow);
        z-index: 10;
        overflow: hidden;
    }
    
    .sidebar {
        display: flex;
        flex-direction: column;
        gap: 20px;
        max-height: calc(100vh - 48px);
        overflow-y: auto;
    }
    
    /* Header & Title */
    .header-container {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
    }
    
    .app-title {
      margin: 0;
      font-size: 24px;
      font-weight: 700;
      /* Gradient text effect */
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .app-subtitle {
      color: var(--text-secondary);
      font-size: 14px;
      margin-top: 4px;
    }
    
    .game-button {
        display: flex;
        align-items: center;
        gap: 6px;
        background-color: var(--bg-card-light); 
        color: var(--secondary);
        padding: 8px 12px;
        border-radius: 8px;
        font-size: 14px;
        text-decoration: none;
        border: 1px solid var(--border);
        transition: var(--transition);
    }
    .game-button:hover {
        background-color: rgba(255, 255, 255, 0.1);
        color: var(--secondary-light);
    }
    
    /* Form Elements */
    .form-group label {
        display: block;
        font-size: 14px;
        font-weight: 500;
        margin-bottom: 8px;
        color: var(--text-secondary);
    }

    .form-group input[type=range] {
        width: 100%;
        -webkit-appearance: none;
        appearance: none;
        height: 8px;
        background: var(--bg-card-light);
        border-radius: 4px;
        margin-top: 5px;
        transition: var(--transition);
    }
    .form-group input[type=range]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: var(--primary);
        cursor: pointer;
        border: 3px solid var(--text-primary);
        box-shadow: 0 0 4px rgba(0, 0, 0, 0.5);
        transition: var(--transition);
    }
    .form-group input[type=range]::-webkit-slider-thumb:hover {
        background: var(--primary-dark);
    }
    
    .form-group select {
        width: 100%;
        padding: 10px;
        border: 1px solid var(--border);
        border-radius: 8px;
        background-color: var(--bg-card-light);
        color: var(--text-primary);
        appearance: none;
        background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%239aa8b2"><path d="M7 10l5 5 5-5z"/></svg>');
        background-repeat: no-repeat;
        background-position: right 10px center;
        cursor: pointer;
    }
    
    .range-value {
        display: flex;
        justify-content: space-between;
        font-size: 13px;
        margin-top: 4px;
        color: var(--text-muted);
    }
    
    /* Buttons */
    .btn-group {
        display: flex;
        gap: 12px;
        margin-top: 10px;
    }
    .btn {
        flex-grow: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        background: var(--primary);
        border: none;
        padding: 12px;
        border-radius: 8px;
        color: white;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.3s, transform 0.1s, box-shadow 0.3s;
    }
    .btn:hover {
        background: var(--primary-dark);
        box-shadow: 0 4px 15px rgba(43, 140, 190, 0.4);
    }
    .btn-ghost {
        background: var(--bg-card-light);
        border: 1px solid var(--border);
        color: var(--text-primary);
    }
    .btn-ghost:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: var(--primary);
    }
    .btn:active {
        transform: translateY(1px);
    }

    /* Data Grid & Results */
    .data-grid {
        display: grid;
        grid-template-columns: 1.5fr 1fr;
        gap: 24px;
        height: 100%;
        min-height: 250px;
    }
    .data-panel {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    .coords {
        color: var(--secondary);
        font-weight: 600;
        font-size: 14px;
    }
    .data-summary-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 8px;
        border-bottom: 1px dashed var(--border);
        padding-bottom: 4px;
    }
    .data-summary-content {
        color: var(--text-secondary);
        font-size: 14px;
    }
    
    .card-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--text-primary);
    }
    .card-subtitle {
        font-size: 13px;
        color: var(--text-muted);
        margin-top: 4px;
    }

    .results-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-top: 15px;
    }
    .result-item {
        padding: 12px;
        background: rgba(43, 140, 190, 0.1);
        border: 1px solid var(--border);
        border-radius: 8px;
    }
    .result-label {
        font-size: 12px;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    .result-value {
        font-size: 24px;
        font-weight: 700;
        margin-top: 4px;
        color: var(--text-primary);
    }
    .result-value.score {
        background: linear-gradient(45deg, var(--secondary), var(--success));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        font-size: 28px;
    }
    
    /* Log */
    .log-container {
        margin-top: 20px;
        min-height: 120px;
    }
    .log {
        background-color: var(--bg-dark);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 10px;
        max-height: 150px;
        overflow-y: auto;
        font-size: 12px;
    }
    .log-entry {
        padding: 4px 0;
        border-bottom: 1px dashed rgba(255, 255, 255, 0.05);
        color: var(--text-secondary);
    }
    .log-time {
        font-weight: 500;
        color: var(--primary);
    }
    
    /* Errors */
    #errors {
        display: none;
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: var(--danger);
        color: white;
        padding: 10px 15px;
        border-radius: 8px;
        z-index: 1000;
        box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    }

    /* Footer */
    footer {
      text-align: center;
      font-size: 12px;
      color: var(--text-muted);
      padding: 12px 0;
      border-top: 1px solid var(--border);
    }
    
    /* Map Marker Popup Styling */
    .leaflet-popup-content-wrapper, .leaflet-popup-tip {
        background: var(--bg-card) !important;
        color: var(--text-primary) !important;
        box-shadow: var(--shadow);
    }
    .leaflet-popup-content {
        padding: 10px !important;
    }

    /* Leaflet Draw Customization */
    .leaflet-draw-toolbar a {
        background-color: var(--bg-card) !important;
        border-radius: 8px;
        color: var(--text-primary) !important;
        border: 1px solid var(--border);
    }
    .leaflet-draw-actions a {
        background-color: var(--primary) !important;
        color: white !important;
    }
    .leaflet-draw-actions a:hover {
        background-color: var(--primary-dark) !important;
    }

    /* Loader */
    #loader {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 2000;
        background-color: var(--bg-card);
        padding: 2rem 3rem;
        border-radius: 1rem;
        box-shadow: var(--shadow);
        text-align: center;
        display: none;
        border: 1px solid var(--border);
    }
    .spinner {
        border: 6px solid var(--bg-card-light);
        border-top: 6px solid var(--primary);
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 0 auto 1rem;
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Tutorial */
    .tutorial-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        z-index: 3000;
        display: none;
        align-items: center;
        justify-content: center;
    }
    .tutorial-card {
        background: var(--bg-card);
        border-radius: var(--radius);
        padding: 30px;
        max-width: 500px;
        margin: 20px;
        box-shadow: var(--shadow);
        border: 1px solid var(--border);
    }
    .tutorial-step {
        display: none;
    }
    .tutorial-step.active {
        display: block;
    }
    .tutorial-navigation {
        display: flex;
        justify-content: space-between;
        margin-top: 20px;
    }
    .tutorial-indicators {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin: 15px 0;
    }
    .tutorial-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--text-muted);
        cursor: pointer;
    }
    .tutorial-indicator.active {
        background: var(--primary);
    }

    /* Notification */
    .custom-notification {
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        background-color: var(--warning);
        color: #333;
        padding: 10px 20px;
        border-radius: 8px;
        z-index: 1001;
        box-shadow: var(--shadow);
        font-size: 14px;
        font-weight: 500;
    }

    /* Responsive design */
    @media (max-width: 1100px) {
        .container {
            grid-template-columns: 1fr;
            grid-template-rows: auto 1fr;
            gap: 16px;
            padding: 16px;
        }
        
        .sidebar {
            order: 2;
            height: auto;
            max-height: 50vh;
        }
        
        .data-grid {
            grid-template-columns: 1fr;
        }
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- Tutorial Overlay -->
    <div class="tutorial-overlay" id="tutorialOverlay">
        <div class="tutorial-card">
            <div class="tutorial-step active" id="step1-tutorial">
                <h3 class="card-title mb-4">–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ AgroVerse! üöÄ</h3>
                <p class="text-sm text-gray-300 mb-4">–¶–µ–π –ø–æ—Å—ñ–±–Ω–∏–∫ –¥–æ–ø–æ–º–æ–∂–µ –≤–∞–º –Ω–∞–≤—á–∏—Ç–∏—Å—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ç–∏—Å—è –Ω–∞—à–∏–º —Å–∏–º—É–ª—è—Ç–æ—Ä–æ–º —Ñ–µ—Ä–º–∏ –∑ –¥–∞–Ω–∏–º–∏ NASA.</p>
                <p class="text-sm text-gray-400">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–î–∞–ª—ñ" —â–æ–± –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏.</p>
            </div>
            
            <div class="tutorial-step" id="step2-tutorial">
                <h3 class="card-title mb-4">–ö—Ä–æ–∫ 1: –û–±–µ—Ä—ñ—Ç—å –¥–∞—Ç—É</h3>
                <p class="text-sm text-gray-300 mb-4">–í–∏–±–µ—Ä—ñ—Ç—å –¥–∞—Ç—É –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É. –î–µ—è–∫—ñ –¥–∞–Ω—ñ –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è —Ä–∞–∑ –Ω–∞ 8 –¥–Ω—ñ–≤.</p>
                <p class="text-sm text-gray-400">–î–ª—è –∫—Ä–∞—â–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –æ–±–∏—Ä–∞–π—Ç–µ –¥–∞—Ç–∏ –Ω–∞ 1-8 –¥–Ω—ñ–≤ —Ä–∞–Ω—ñ—à–µ.</p>
            </div>
            
            <div class="tutorial-step" id="step3-tutorial">
                <h3 class="card-title mb-4">–ö—Ä–æ–∫ 2: –ù–∞–º–∞–ª—é–π—Ç–µ —Ñ–µ—Ä–º—É</h3>
                <p class="text-sm text-gray-300 mb-4">–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç "–ü–æ–ª—ñ–≥–æ–Ω" –Ω–∞ –∫–∞—Ä—Ç—ñ, —â–æ–± –æ–∫—Ä–µ—Å–ª–∏—Ç–∏ –≤–∞—à—É –¥—ñ–ª—è–Ω–∫—É.</p>
                <p class="text-sm text-gray-400">–ö–ª–∞—Ü–∞–π—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—ñ, —â–æ–± —Å—Ç–≤–æ—Ä–∏—Ç–∏ –∫—É—Ç–∏ –ø–æ–ª—ñ–≥–æ–Ω—É, —Ç–∞ –¥–≤—ñ—á—ñ –∫–ª–∞—Ü–Ω—ñ—Ç—å –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è.</p>
            </div>
            
            <div class="tutorial-step" id="step4-tutorial">
                <h3 class="card-title mb-4">–ö—Ä–æ–∫ 3: –ù–∞–ª–∞—à—Ç—É–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏</h3>
                <p class="text-sm text-gray-300 mb-4">–û–±–µ—Ä—ñ—Ç—å –∫—É–ª—å—Ç—É—Ä—É, –≤—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –ø–æ–ª–∏–≤ —Ç–∞ –¥–æ–±—Ä–∏–≤–∞ –¥–ª—è —Å–∏–º—É–ª—è—Ü—ñ—ó.</p>
                <p class="text-sm text-gray-400">–ë–∞–ª–∞–Ω—Å—É–π—Ç–µ –º—ñ–∂ –≤—Ä–æ–∂–∞–π–Ω—ñ—Å—Ç—é —Ç–∞ –µ–∫–æ–ª–æ–≥—ñ—á–Ω—ñ—Å—Ç—é.</p>
            </div>
            
            <div class="tutorial-step" id="step5-tutorial">
                <h3 class="card-title mb-4">–ö—Ä–æ–∫ 4: –ó–∞–ø—É—Å—Ç—ñ—Ç—å —Å–∏–º—É–ª—è—Ü—ñ—é</h3>
                <p class="text-sm text-gray-300 mb-4">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–∏–º—É–ª—è—Ü—ñ—é" –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤.</p>
                <p class="text-sm text-gray-400">–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑—É—î –¥–∞–Ω—ñ NASA —Ç–∞ –Ω–∞–¥–∞—Å—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó.</p>
            </div>
            
            <div class="tutorial-indicators">
                <div class="tutorial-indicator active" data-step="1"></div>
                <div class="tutorial-indicator" data-step="2"></div>
                <div class="tutorial-indicator" data-step="3"></div>
                <div class="tutorial-indicator" data-step="4"></div>
                <div class="tutorial-indicator" data-step="5"></div>
            </div>
            
            <div class="tutorial-navigation">
                <button class="btn btn-ghost" id="prevTutorial">–ù–∞–∑–∞–¥</button>
                <button class="btn" id="nextTutorial">–î–∞–ª—ñ</button>
                <button class="btn" id="skipTutorial" style="display: none;">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç–∏</button>
            </div>
        </div>
    </div>

    <div class="container">
      
      <!-- Left Sidebar - Controls -->
      <div class="card sidebar">
        <div class="header-container">
          <div>
            <h1 class="app-title">AgroVerse</h1>
            <div class="app-subtitle">Farm Navigators ‚Äî –ú—ñ—Å—ñ—è GIS</div>
          </div>
          <div class="flex gap-2">
            <button class="game-button" id="showTutorial" title="–ü–æ–∫–∞–∑–∞—Ç–∏ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z" fill="currentColor"/>
              </svg>
              –î–æ–ø–æ–º–æ–≥–∞
            </button>
            <a href="#" class="game-button" title="Game feature is under development">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M8 5V19L19 12L8 5Z" fill="currentColor"/>
              </svg>
              Game (MVP)
            </a>
          </div>
        </div>

        <!-- Date Selection -->
        <div class="form-group">
          <label for="date-picker">–ö—Ä–æ–∫ 1: –û–±–µ—Ä—ñ—Ç—å –¥–∞—Ç—É –∞–Ω–∞–ª—ñ–∑—É</label>
          <input type="date" id="date-picker" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-800 text-white">
          <div class="text-xs text-gray-400 mt-1">–î–µ—è–∫—ñ –¥–∞–Ω—ñ –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è —Ä–∞–∑ –Ω–∞ 8 –¥–Ω—ñ–≤</div>
        </div>
        
        <div class="data-panel">
            <div class="data-summary-title">–û–±—Ä–∞–Ω–∞ –¥—ñ–ª—è–Ω–∫–∞</div>
            <div id="coords" class="coords">–ù–∞–º–∞–ª—é–π—Ç–µ –ø–æ–ª—ñ–≥–æ–Ω –Ω–∞ –∫–∞—Ä—Ç—ñ</div>
            <div id="dataSummary" class="data-summary-content">
                –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç "–ü–æ–ª—ñ–≥–æ–Ω" –Ω–∞ –∫–∞—Ä—Ç—ñ, —â–æ–± –æ–∫—Ä–µ—Å–ª–∏—Ç–∏ –≤–∞—à—É –∑–æ–Ω—É —ñ–Ω—Ç–µ—Ä–µ—Å—É.
            </div>
        </div>

        <div class="form-group">
          <label for="cropSelect">–ö—Ä–æ–∫ 2: –û–±–µ—Ä—ñ—Ç—å –∫—É–ª—å—Ç—É—Ä—É</label>
          <select id="cropSelect">
            <option value="maize">–ö—É–∫—É—Ä—É–¥–∑–∞</option>
            <option value="wheat">–ü—à–µ–Ω–∏—Ü—è</option>
            <option value="soy">–°–æ—è</option>
            <option value="sorghum">–°–æ—Ä–≥–æ</option>
          </select>
        </div>

        <div class="form-group">
          <label for="irrigation">–ü–æ–ª–∏–≤ (–º–º / –¥–µ–Ω—å)</label>
          <input id="irrigation" type="range" min="0" max="10" step="0.5" value="3">
          <div class="range-value">
            <span>–Ü–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ñ—Å—Ç—å –ø–æ–ª–∏–≤—É</span>
            <span id="irrigationOut">3.0</span>
          </div>
        </div>

        <div class="form-group">
          <label for="fert">–î–æ–±—Ä–∏–≤–∞ (–∫–≥ / –≥–∞)</label>
          <input id="fert" type="range" min="0" max="200" step="10" value="80">
          <div class="range-value">
            <span>–í–Ω–µ—Å–µ–Ω–æ –¥–æ–±—Ä–∏–≤ (N)</span>
            <span id="fertOut">80</span>
          </div>
        </div>

        <!-- Action Button -->
        <div class="btn-group">
          <button id="runSim" class="btn" disabled>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M8 5V19L19 12L8 5Z" fill="currentColor"/>
            </svg>
            –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–∏–º—É–ª—è—Ü—ñ—é (1 —Ä—ñ–∫)
          </button>
          <button class="btn btn-ghost" id="reset">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4C7.58 4 4.01 7.58 4.01 12C4.01 16.42 7.58 20 12 20C15.73 20 18.84 17.45 19.73 14H17.65C16.83 16.33 14.61 18 12 18C8.69 18 6 15.31 6 12C6 8.69 8.69 6 12 6C13.66 6 15.14 6.69 16.22 7.78L13 11H20V4L17.65 6.35Z" fill="currentColor"/>
            </svg>
            –°–∫–∏–Ω—É—Ç–∏
          </button>
        </div>

        <div class="mt-4 p-4 bg-blue-900 border-l-4 border-blue-400 text-blue-200 text-sm rounded">
          <p><strong>–ü—Ä–∏–º—ñ—Ç–∫–∞:</strong> –î–µ—è–∫—ñ –¥–∞–Ω—ñ (NDVI, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞) –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è —Ä–∞–∑ –Ω–∞ 8 –¥–Ω—ñ–≤. –Ø–∫—â–æ —à–∞—Ä –Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è, —Å–ø—Ä–æ–±—É–π—Ç–µ –æ–±—Ä–∞—Ç–∏ –¥–∞—Ç—É –Ω–∞ 1-8 –¥–Ω—ñ–≤ —Ä–∞–Ω—ñ—à–µ.</p>
        </div>
        
        <div class="log-container">
            <label>–ñ—É—Ä–Ω–∞–ª –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ</label>
            <div class="log" id="log">
                <div class="log-entry">
                    <span class="log-time">[Init]</span> –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞. –û–±–µ—Ä—ñ—Ç—å –¥–∞—Ç—É —Ç–∞ –Ω–∞–º–∞–ª—é–π—Ç–µ –¥—ñ–ª—è–Ω–∫—É –Ω–∞ –∫–∞—Ä—Ç—ñ.
                </div>
            </div>
        </div>
      </div>

      <!-- Right Panel - Map and Data Grid -->
      <div class="flex-grow flex flex-col gap-6">
        <div style="flex-grow: 1; position: relative;">
          <!-- Map container -->
          <div id="map"></div>
          
          <!-- Loader -->
          <div id="loader">
            <div class="spinner"></div>
            <p class="text-lg font-semibold text-gray-300">–û–±—Ä–æ–±–∫–∞ –∑–∞–ø–∏—Ç—É –¥–æ NASA...</p>
            <p class="text-sm text-gray-400">–ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Å—É–ø—É—Ç–Ω–∏–∫–æ–≤—ñ –¥–∞–Ω—ñ.</p>
          </div>

          <!-- Errors Notification -->
          <div id="errors"></div>
        </div>

        <!-- Data Grid -->
        <div class="data-grid">
          <div class="card data-card">
            <div class="card-header">
              <h3 class="card-title">–ü—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥–∏ / –î–∞–Ω—ñ NASA POWER</h3>
              <div class="card-subtitle">–û—Ç—Ä–∏–º–∞–Ω–æ –º–µ—Ç–µ–æ—Ä–æ–ª–æ–≥—ñ—á–Ω—ñ –¥–∞–Ω—ñ –¥–ª—è —Å–∏–º—É–ª—è—Ü—ñ—ó.</div>
            </div>
            <div id="powerDataSummary" style="margin-top: 15px;">–ù–∞–º–∞–ª—é–π—Ç–µ –¥—ñ–ª—è–Ω–∫—É —Ç–∞ –æ–±–µ—Ä—ñ—Ç—å –¥–∞—Ç—É –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É –¥–∞–Ω–∏—Ö.</div>
          </div>

          <div class="card data-card">
            <div class="card-header">
              <h3 class="card-title">–ü—ñ–¥—Å—É–º–æ–∫ —Å–µ–∑–æ–Ω—É</h3>
              <div class="card-subtitle">–û—Ü—ñ–Ω–∫–∞ –µ–∫–æ–ª–æ–≥—ñ—á–Ω–æ—Å—Ç—ñ —Ç–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ</div>
            </div>
            <div class="results-grid">
              <div class="result-item">
                <div class="result-label">–í—Ä–æ–∂–∞–π (–∫–≥/–≥–∞)</div>
                <div class="result-value" id="yieldVal">‚Äî</div>
              </div>
              <div class="result-item">
                <div class="result-label">–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤–æ–¥–∏ (–º¬≥)</div>
                <div class="result-value" id="waterVal">‚Äî</div>
              </div>
              <div class="result-item">
                <div class="result-label">–í–∏–∫–∏–¥–∏ / –µ–∫–æ–ª–æ–≥—ñ—è</div>
                <div class="result-value" id="ecoVal">‚Äî</div>
              </div>
              <div class="result-item">
                <div class="result-label">–û—Ü—ñ–Ω–∫–∞</div>
                <div class="result-value score" id="scoreVal">‚Äî</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <footer>–ü—Ä–æ—Ç–æ—Ç–∏–ø ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ NASA POWER API & GIBS. –£ –ø–æ–≤–Ω—ñ–π –≤–µ—Ä—Å—ñ—ó –±—É–¥—É—Ç—å —ñ–Ω—à—ñ —Å–µ—Ä–≤—ñ—Å–∏.</footer>
  </div>

  <!-- Leaflet & GIS Libraries -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <!-- Leaflet Draw -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
  <!-- Turf.js –¥–ª—è –≥–µ–æ–æ–ø–µ—Ä–∞—Ü—ñ–π -->
  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>

  <script>
    // --- –ì–õ–û–ë–ê–õ–¨–ù–Ü –ó–ú–Ü–ù–ù–Ü ---
    let map;
    let drawnLayer = null;
    let mapLayers = {};
    let layerControl = null;
    let drawnItems = null;
    let drawControl = null;
    
    const errorsEl = document.getElementById('errors');
    const runSimBtn = document.getElementById('runSim');
    const coordsEl = document.getElementById('coords');
    const powerDataSummaryEl = document.getElementById('powerDataSummary');
    const datePicker = document.getElementById('date-picker');
    const loader = document.getElementById('loader');
    
    // Tutorial variables
    let currentTutorialStep = 1;
    const totalTutorialSteps = 5;

    // --- –î–û–ü–û–ú–Ü–ñ–ù–Ü –§–£–ù–ö–¶–Ü–á ---
    
    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø–æ–º–∏–ª–æ–∫
    function showError(msg) {
      console.error(msg);
      errorsEl.textContent = msg;
      errorsEl.style.display = 'block';
      setTimeout(() => {
        errorsEl.style.display = 'none';
      }, 5000);
    }
    
    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —É –ª–æ–≥
    function log(text) {
      const logEl = document.getElementById('log');
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      const time = new Date().toLocaleTimeString('uk-UA');
      entry.innerHTML = `<span class="log-time">[${time}]</span> ${text}`;
      logEl.prepend(entry);
      
      // –û–±–º–µ–∂–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –∑–∞–ø–∏—Å—ñ–≤ —É –ª–æ–∑—ñ –¥–æ 10
      if (logEl.children.length > 10) {
        logEl.removeChild(logEl.lastChild);
      }
    }
    
    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–Ω–∞—á–µ–Ω—å –ø–æ–ª–∏–≤—É
    function updateIrrigationValue(e) {
      document.getElementById('irrigationOut').textContent = e.target.value;
      log(`–ó–Ω–∞—á–µ–Ω–Ω—è –ø–æ–ª–∏–≤—É –∑–º—ñ–Ω–µ–Ω–æ –Ω–∞: ${e.target.value} –º–º/–¥–µ–Ω—å`);
    }

    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–Ω–∞—á–µ–Ω—å –¥–æ–±—Ä–∏–≤
    function updateFertilizerValue(e) {
      document.getElementById('fertOut').textContent = e.target.value;
      log(`–ó–Ω–∞—á–µ–Ω–Ω—è –¥–æ–±—Ä–∏–≤ –∑–º—ñ–Ω–µ–Ω–æ –Ω–∞: ${e.target.value} –∫–≥/–≥–∞`);
    }

    // –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —Å–∏–º—É–ª—è—Ü—ñ—ó
    function displaySimulationResults(results) {
      document.getElementById('yieldVal').textContent = `${results.yield} –∫–≥`;
      document.getElementById('waterVal').textContent = `${results.water} –º¬≥`;
      document.getElementById('ecoVal').textContent = results.eco;
      document.getElementById('scoreVal').textContent = results.score;
      log('–°–∏–º—É–ª—è—Ü—ñ—è —É—Å–ø—ñ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –æ–Ω–æ–≤–ª–µ–Ω–æ.');
    }

    // –°–∫–∏–¥–∞–Ω–Ω—è —Ñ–æ—Ä–º–∏ –¥–æ –ø–æ—á–∞—Ç–∫–æ–≤–æ–≥–æ —Å—Ç–∞–Ω—É
    function resetForm() {
      document.getElementById('irrigation').value = 3;
      document.getElementById('irrigationOut').textContent = '3.0';
      document.getElementById('fert').value = 80;
      document.getElementById('fertOut').textContent = '80';
      document.getElementById('cropSelect').value = 'maize';
      coordsEl.textContent = '–ù–∞–º–∞–ª—é–π—Ç–µ –ø–æ–ª—ñ–≥–æ–Ω –Ω–∞ –∫–∞—Ä—Ç—ñ';
      powerDataSummaryEl.innerHTML = '–ù–∞–º–∞–ª—é–π—Ç–µ –¥—ñ–ª—è–Ω–∫—É —Ç–∞ –æ–±–µ—Ä—ñ—Ç—å –¥–∞—Ç—É –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É –¥–∞–Ω–∏—Ö.';
      
      // –°–∫–∏–¥–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
      document.getElementById('yieldVal').textContent = '‚Äî';
      document.getElementById('waterVal').textContent = '‚Äî';
      document.getElementById('ecoVal').textContent = '‚Äî';
      document.getElementById('scoreVal').textContent = '‚Äî';
      
      // –°–∫–∏–¥–∞–Ω–Ω—è –∫–∞—Ä—Ç–∏
      if (drawnLayer) {
        drawnItems.removeLayer(drawnLayer);
        drawnLayer = null;
      }
      
      Object.values(mapLayers).forEach(layer => map.removeLayer(layer));
      mapLayers = {};
      if (layerControl) map.removeControl(layerControl);

      updateUIState();
      log('–ü–∞—Ä–∞–º–µ—Ç—Ä–∏ —Å–∫–∏–Ω—É—Ç–æ –¥–æ –ø–æ—á–∞—Ç–∫–æ–≤–∏—Ö –∑–Ω–∞—á–µ–Ω—å');
    }

    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞–Ω—É UI
    function updateUIState() {
      if (drawnLayer && datePicker.value) {
        runSimBtn.disabled = false;
      } else {
        runSimBtn.disabled = true;
      }
    }

    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç–∏–º—á–∞—Å–æ–≤–æ–≥–æ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –Ω–∞ –∫–∞—Ä—Ç—ñ
    function showErrorNotification(layerName) {
      const notification = L.DomUtil.create('div', 'custom-notification', map.getContainer());
      notification.innerHTML = `–î–∞–Ω—ñ –¥–ª—è —à–∞—Ä—É "${layerName}" –Ω–∞ –æ–±—Ä–∞–Ω—É –¥–∞—Ç—É –≤—ñ–¥—Å—É—Ç–Ω—ñ. –°–ø—Ä–æ–±—É–π—Ç–µ —ñ–Ω—à—É –¥–∞—Ç—É.`;
      
      setTimeout(() => {
        if (notification.parentNode) {
          notification.parentNode.removeChild(notification);
        }
      }, 5000);
    }

    function getSelectedDate() {
      return datePicker.value;
    }

    // --- –õ–û–ì–Ü–ö–ê –ö–ê–†–¢–ò –¢–ê –ü–û–î–Ü–ô ---

    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Leaflet –∫–∞—Ä—Ç–∏
    function initializeMap() {
      map = L.map('map', {
        minZoom: 2,
        maxZoom: 18,
        worldCopyJump: false,
        maxBounds: [[-85, -180], [85, 180]],
        maxBoundsViscosity: 1.0
      }).setView([48.3794, 31.1656], 6); // –¶–µ–Ω—Ç—Ä –£–∫—Ä–∞—ó–Ω–∏

      // Base layer
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '¬© OpenStreetMap contributors'
      }).addTo(map);

      // Draw controls
      drawnItems = new L.FeatureGroup();
      map.addLayer(drawnItems);

      drawControl = new L.Control.Draw({
        edit: {
          featureGroup: drawnItems,
          remove: true
        },
        draw: {
          polygon: {
            allowIntersection: false,
            showArea: true
          },
          polyline: false,
          rectangle: false,
          circle: false,
          marker: false,
          circlemarker: false
        }
      });
      map.addControl(drawControl);

      // Map events for drawing
      map.on(L.Draw.Event.CREATED, (e) => {
        if (drawnLayer) drawnItems.removeLayer(drawnLayer);
        drawnLayer = e.layer;
        drawnItems.addLayer(drawnLayer);
        
        const area = L.GeometryUtil.geodesicArea(drawnLayer.getLatLngs()[0]);
        const areaHa = (area / 10000).toFixed(2);
        coordsEl.textContent = `–ü–ª–æ—â–∞: ${areaHa} –≥–∞`;
        
        updateUIState();
        log(`–ù–∞–º–∞–ª—å–æ–≤–∞–Ω–æ –¥—ñ–ª—è–Ω–∫—É –ø–ª–æ—â–µ—é ${areaHa} –≥–∞`);
      });

      map.on(L.Draw.Event.EDITED, (e) => {
        e.layers.eachLayer((layer) => { 
          drawnLayer = layer; 
          const area = L.GeometryUtil.geodesicArea(drawnLayer.getLatLngs()[0]);
          const areaHa = (area / 10000).toFixed(2);
          coordsEl.textContent = `–ü–ª–æ—â–∞: ${areaHa} –≥–∞`;
        });
        updateUIState();
        log('–î—ñ–ª—è–Ω–∫—É –≤—ñ–¥—Ä–µ–¥–∞–≥–æ–≤–∞–Ω–æ');
      });

      map.on(L.Draw.Event.DELETED, () => {
        drawnLayer = null;
        coordsEl.textContent = '–ù–∞–º–∞–ª—é–π—Ç–µ –ø–æ–ª—ñ–≥–æ–Ω –Ω–∞ –∫–∞—Ä—Ç—ñ';
        updateUIState();
        log('–î—ñ–ª—è–Ω–∫—É –≤–∏–¥–∞–ª–µ–Ω–æ');
      });
    }

    // --- –õ–û–ì–Ü–ö–ê NASA POWER API & GIBS ---

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö NASA GIBS
    function fetchNasaData() {
      if (!drawnLayer) {
        showError('–ë—É–¥—å –ª–∞—Å–∫–∞, —Å–ø–æ—á–∞—Ç–∫—É –Ω–∞–º–∞–ª—é–π—Ç–µ –¥—ñ–ª—è–Ω–∫—É –Ω–∞ –∫–∞—Ä—Ç—ñ.');
        return;
      }
      if (!datePicker.value) {
        showError('–ë—É–¥—å –ª–∞—Å–∫–∞, –æ–±–µ—Ä—ñ—Ç—å –¥–∞—Ç—É –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É.');
        return;
      }

      loader.style.display = 'flex';
      
      // Clean up previous layers
      Object.values(mapLayers).forEach(layer => map.removeLayer(layer));
      mapLayers = {};
      if (layerControl) map.removeControl(layerControl);

      const selectedDate = getSelectedDate();
      
      const nasaGibsLayers = {
        "–°—É–ø—É—Ç–Ω–∏–∫–æ–≤–∏–π –∑–Ω—ñ–º–æ–∫ (True Color)": `https://gibs.earthdata.nasa.gov/wmts/epsg3857/best/MODIS_Terra_CorrectedReflectance_TrueColor/default/${selectedDate}/GoogleMapsCompatible_Level9/{z}/{y}/{x}.jpg`,
        "–Ü–Ω–¥–µ–∫—Å –≤–µ–≥–µ—Ç–∞—Ü—ñ—ó (NDVI)": `https://gibs.earthdata.nasa.gov/wmts/epsg3857/best/MODIS_Terra_NDVI_8Day/default/${selectedDate}/GoogleMapsCompatible_Level7/{z}/{y}/{x}.png`,
        "–í–æ–ª–æ–≥—ñ—Å—Ç—å “ë—Ä—É–Ω—Ç—É (SMAP)": `https://gibs.earthdata.nasa.gov/wmts/epsg3857/best/SMAP_L3_SM_P_E_Daily/default/${selectedDate}/GoogleMapsCompatible_Level6/{z}/{y}/{x}.png`,
        "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ø–æ–≤–µ—Ä—Ö–Ω—ñ (–¥–µ–Ω—å)": `https://gibs.earthdata.nasa.gov/wmts/epsg3857/best/MODIS_Terra_LST_Day_8Day/default/${selectedDate}/GoogleMapsCompatible_Level7/{z}/{y}/{x}.png`
      };

      const baseLayers = { 
        "OpenStreetMap": L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '¬© OpenStreetMap contributors'
        })
      };
      
      const overlayLayers = {};

      for (const [name, url] of Object.entries(nasaGibsLayers)) {
        const layer = L.tileLayer(url, {
          attribution: 'NASA GIBS',
          opacity: 0.75,
          maxNativeZoom: getLayerMaxZoom(name) 
        });

        // Add error handling for each tile layer
        layer.on('tileerror', (e) => {
          if (!layer.hasError) {
            showErrorNotification(name);
            layer.hasError = true;
          }
        });
        layer.on('load', () => { layer.hasError = false; });
        
        overlayLayers[name] = layer;
        mapLayers[name] = layer;
      }
      
      // Add first overlay layer by default
      if (Object.keys(overlayLayers).length > 0) {
        const firstLayer = Object.values(overlayLayers)[0];
        firstLayer.addTo(map);
      }

      layerControl = L.control.layers(baseLayers, overlayLayers, {collapsed: false}).addTo(map);
      map.fitBounds(drawnLayer.getBounds());
      
      // Update info panel
      const area = L.GeometryUtil.geodesicArea(drawnLayer.getLatLngs()[0]);
      const areaHa = (area / 10000).toFixed(2);
      powerDataSummaryEl.innerHTML = `
        <div class="text-sm">
          <p><strong>–ü–ª–æ—â–∞:</strong> ${areaHa} –≥–µ–∫—Ç–∞—Ä—ñ–≤</p>
          <p><strong>–î–∞—Ç–∞ –∞–Ω–∞–ª—ñ–∑—É:</strong> ${selectedDate}</p>
          <p class="mt-2 text-green-400">–î–∞–Ω—ñ NASA —É—Å–ø—ñ—à–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ!</p>
        </div>
      `;

      setTimeout(() => {
        loader.style.display = 'none';
        log(`–î–∞–Ω—ñ NASA –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –¥–ª—è –¥—ñ–ª—è–Ω–∫–∏ ${areaHa} –≥–∞ (${selectedDate})`);
      }, 2000);
    }

    function getLayerMaxZoom(layerName) {
      if (layerName.includes("True Color")) return 9;
      if (layerName.includes("NDVI")) return 7;
      if (layerName.includes("–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞")) return 7;
      if (layerName.includes("SMAP")) return 6;
      return 8;
    }

    // –ï–º—É–ª—è—Ü—ñ—è —Ñ—É–Ω–∫—Ü—ñ—ó, —â–æ –∑–∞–ø—É—Å–∫–∞—î —Å–∏–º—É–ª—è—Ü—ñ—é
    function runSimulation() {
      if (!drawnLayer) {
        showError('–ë—É–¥—å –ª–∞—Å–∫–∞, –æ–±–µ—Ä—ñ—Ç—å –¥—ñ–ª—è–Ω–∫—É –Ω–∞ –∫–∞—Ä—Ç—ñ, –ø–µ—Ä—à –Ω—ñ–∂ –∑–∞–ø—É—Å–∫–∞—Ç–∏ —Å–∏–º—É–ª—è—Ü—ñ—é.');
        return;
      }

      runSimBtn.disabled = true;
      runSimBtn.innerHTML = '<div class="spinner" style="width:16px;height:16px;border-width:2px;"></div> –û–±—á–∏—Å–ª–µ–Ω–Ω—è...';
      log('–°–∏–º—É–ª—è—Ü—ñ—è –∑–∞–ø—É—â–µ–Ω–∞...');

      // –û—Ç—Ä–∏–º–∞–Ω–Ω—è –≤—Ö—ñ–¥–Ω–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤
      const crop = document.getElementById('cropSelect').value;
      const irrigation = parseFloat(document.getElementById('irrigation').value);
      const fert = parseFloat(document.getElementById('fert').value);
      
      // –ï–º—É–ª—è—Ü—ñ—è –∑–∞—Ç—Ä–∏–º–∫–∏ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è —Å–∏–º—É–ª—è—Ü—ñ—ó
      setTimeout(() => {
        // –ï–º—É–ª—è—Ü—ñ—è —Å–∫–ª–∞–¥–Ω–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º—É —Å–∏–º—É–ª—è—Ü—ñ—ó
        let yieldFactor = 4500;
        let waterFactor = 200;
        let ecoFactor = '–°–µ—Ä–µ–¥–Ω—ñ–π';
        let score = 75;

        // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –Ω–∞ –æ—Å–Ω–æ–≤—ñ –≤—Ö—ñ–¥–Ω–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤
        if (crop === 'maize') {
          yieldFactor += irrigation * 100 + fert * 5;
          waterFactor += irrigation * 50;
        } else if (crop === 'wheat') {
          yieldFactor += irrigation * 70 + fert * 7;
          waterFactor += irrigation * 30;
        }

        // –õ–æ–≥—ñ–∫–∞ –æ—Ü—ñ–Ω–∫–∏
        if (fert > 150) {
            ecoFactor = '–ù–∏–∑—å–∫–∏–π (–ù–∞–¥–ª–∏—à–æ–∫ –¥–æ–±—Ä–∏–≤)';
            score -= 10;
        } else if (irrigation > 8) {
            waterFactor += 200;
            ecoFactor = '–ü–æ—Å–µ—Ä–µ–¥–Ω—ñ–π (–í–∏—Å–æ–∫–µ —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è –≤–æ–¥–∏)';
            score -= 5;
        } else {
            ecoFactor = '–í–∏—Å–æ–∫–∏–π';
            score += 5;
        }

        const results = {
          yield: yieldFactor.toFixed(0),
          water: waterFactor.toFixed(0),
          eco: ecoFactor,
          score: Math.min(100, Math.max(50, score)).toFixed(0) + '/100'
        };

        displaySimulationResults(results);
        
        runSimBtn.disabled = false;
        runSimBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 5V19L19 12L8 5Z" fill="currentColor"/></svg> –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–∏–º—É–ª—è—Ü—ñ—é (1 —Ä—ñ–∫)';

      }, 3000);
    }

    // --- TUTORIAL FUNCTIONS ---
    function showTutorial() {
      document.getElementById('tutorialOverlay').style.display = 'flex';
      currentTutorialStep = 1;
      updateTutorialStep();
    }

    function updateTutorialStep() {
      // Hide all steps
      document.querySelectorAll('.tutorial-step').forEach(step => {
        step.classList.remove('active');
      });
      
      // Show current step
      document.getElementById(`step${currentTutorialStep}-tutorial`).classList.add('active');
      
      // Update indicators
      document.querySelectorAll('.tutorial-indicator').forEach((indicator, index) => {
        indicator.classList.toggle('active', index + 1 === currentTutorialStep);
      });
      
      // Update navigation buttons
      document.getElementById('prevTutorial').style.display = currentTutorialStep > 1 ? 'block' : 'none';
      document.getElementById('nextTutorial').style.display = currentTutorialStep < totalTutorialSteps ? 'block' : 'none';
      document.getElementById('skipTutorial').style.display = currentTutorialStep === totalTutorialSteps ? 'block' : 'none';
    }

    function nextTutorialStep() {
      if (currentTutorialStep < totalTutorialSteps) {
        currentTutorialStep++;
        updateTutorialStep();
      } else {
        closeTutorial();
      }
    }

    function prevTutorialStep() {
      if (currentTutorialStep > 1) {
        currentTutorialStep--;
        updateTutorialStep();
      }
    }

    function closeTutorial() {
      document.getElementById('tutorialOverlay').style.display = 'none';
    }

    // --- –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø ---
    
    window.onload = function() {
      // Set default date
      const today = new Date();
      const yesterday = new Date(today);
      yesterday.setDate(today.getDate() - 2);
      
      datePicker.value = yesterday.toISOString().split('T')[0];
      datePicker.max = today.toISOString().split('T')[0];

      initializeMap();
      setupEventListeners();
      
      // Show tutorial on first visit
      if (!localStorage.getItem('agroverseTutorialShown')) {
        setTimeout(showTutorial, 1000);
        localStorage.setItem('agroverseTutorialShown', 'true');
      }
      
      log('–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –¥–æ —Ä–æ–±–æ—Ç–∏. –û–±–µ—Ä—ñ—Ç—å –¥–∞—Ç—É —Ç–∞ –Ω–∞–º–∞–ª—é–π—Ç–µ –¥—ñ–ª—è–Ω–∫—É.');
    }

    function setupEventListeners() {
      const irrigationInput = document.getElementById('irrigation');
      const fertInput = document.getElementById('fert');
      const resetBtn = document.getElementById('reset');

      // Range input events
      irrigationInput.addEventListener('input', updateIrrigationValue);
      fertInput.addEventListener('input', updateFertilizerValue);

      // Action buttons
      runSimBtn.addEventListener('click', runSimulation);
      resetBtn.addEventListener('click', resetForm);
      
      // Date picker
      datePicker.addEventListener('change', updateUIState);
      
      // Tutorial events
      document.getElementById('showTutorial').addEventListener('click', showTutorial);
      document.getElementById('nextTutorial').addEventListener('click', nextTutorialStep);
      document.getElementById('prevTutorial').addEventListener('click', prevTutorialStep);
      document.getElementById('skipTutorial').addEventListener('click', closeTutorial);
      
      // Initial values display
      document.getElementById('irrigationOut').textContent = irrigationInput.value;
      document.getElementById('fertOut').textContent = fertInput.value;
    }
  </script>
</body>
</html>